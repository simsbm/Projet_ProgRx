# Architecture de la configuration de la base de donnÃ©es - Diagramme

## 1. Flux de dÃ©marrage du serveur

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Program.cs - Main()                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    [STARTUP] Initialisation...
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
        â–¼                     â–¼                     â–¼
   Configuration        Contexte BD         Services
    JWT chargÃ©e        (AppDbContext)    (Auth + Init)
   (60 min exp)        (SQLite crÃ©Ã©)      (PrÃ©parÃ©s)
        â”‚                     â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    DatabaseInitializer
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
        â–¼                     â–¼                     â–¼
  EnsureCreated()       VÃ©rifier existants   CrÃ©er utilisateurs
  (CrÃ©e schÃ©ma)         (if Users.Any())         par dÃ©faut
        â”‚                     â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                        DatabaseTest
                              â”‚
                  Afficher le rapport de statut
                              â”‚
                              â–¼
                    Application WPF lancÃ©e
                              â”‚
                       [Interface utilisateur]
```

## 2. HiÃ©rarchie des entitÃ©s et relations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Utilisateurs                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   User (Administrator/Supervisor/Operator/Viewer)      â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ â€¢ Id (PK)                                              â”‚  â”‚
â”‚  â”‚ â€¢ Username (UNIQUE)                                    â”‚  â”‚
â”‚  â”‚ â€¢ PasswordHash (BCrypt)                                â”‚  â”‚
â”‚  â”‚ â€¢ Email (UNIQUE)                                       â”‚  â”‚
â”‚  â”‚ â€¢ FullName, Role, IsActive, CreatedAt                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â”‚ 1:N                       â”‚ 1:N                â”‚
â”‚               â”‚                           â”‚                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚  AuthTokens (JWT)    â”‚    â”‚   AuditLogs          â”‚      â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚   â”‚ â€¢ Id (PK)            â”‚    â”‚ â€¢ Id (PK)            â”‚      â”‚
â”‚   â”‚ â€¢ UserId (FK)        â”‚    â”‚ â€¢ UserId (FK, Null)  â”‚      â”‚
â”‚   â”‚ â€¢ Token (JWT)        â”‚    â”‚ â€¢ Action             â”‚      â”‚
â”‚   â”‚ â€¢ RefreshToken       â”‚    â”‚ â€¢ TargetMachine      â”‚      â”‚
â”‚   â”‚ â€¢ IssuedAt/ExpiresAt â”‚    â”‚ â€¢ Username           â”‚      â”‚
â”‚   â”‚ â€¢ IpAddress/UserAgentâ”‚    â”‚ â€¢ Details, Success   â”‚      â”‚
â”‚   â”‚ â€¢ RevokedAt (Null)   â”‚    â”‚ â€¢ Timestamp          â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Infrastructure                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     ClientHost (Machines enregistrÃ©es)                 â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ â€¢ Id (PK)                                              â”‚  â”‚
â”‚  â”‚ â€¢ MachineName (UNIQUE)                                 â”‚  â”‚
â”‚  â”‚ â€¢ IpAddress, OSVersion                                 â”‚  â”‚
â”‚  â”‚ â€¢ IsOnline, LastSeen                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                        â”‚ 1:N                                 â”‚
â”‚                        â”‚                                    â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚           â”‚   MetricLogs             â”‚                    â”‚
â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
â”‚           â”‚ â€¢ Id (PK)                 â”‚                    â”‚
â”‚           â”‚ â€¢ ClientHostId (FK)       â”‚                    â”‚
â”‚           â”‚ â€¢ CpuUsage, RamAvailable  â”‚                    â”‚
â”‚           â”‚ â€¢ Timestamp               â”‚                    â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. Processus d'initialisation dÃ©taillÃ©

```
START
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Lire configuration JWT           â”‚
â”‚ â€¢ Secret: 32+ caractÃ¨res         â”‚
â”‚ â€¢ Token exp: 60 minutes          â”‚
â”‚ â€¢ Refresh exp: 7 jours           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CrÃ©er AppDbContext               â”‚
â”‚ â†’ Connection: netadmin.db        â”‚
â”‚ â†’ ChaÃ®ne: Data Source=netadmin.dbâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CrÃ©er AuthenticationService      â”‚
â”‚ â†’ Context + JWT params           â”‚
â”‚ â†’ Utilise BCrypt pour hachage    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CrÃ©er DatabaseInitializer        â”‚
â”‚ â†’ Context + AuthService          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Appel: Initialize()              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚
        â–¼             â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚EnsureCreated â”‚  â”‚ if Users.Any()?        â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                  â”‚
    [SchÃ©ma]         â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    CrÃ©Ã© ou          â”‚             â”‚
    Existe       OUI â”‚        NON  â”‚ Initialiser
         â”‚           â”‚             â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
         â”‚                               â”‚
         â–¼                               â–¼
   [BD PrÃªte]                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                               â”‚ CrÃ©er 4 utilisateurs â”‚
                               â”‚ + GÃ©nÃ©rer JWT tokens â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
                                    [Utilisateurs]
                                          â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                â”‚                                â”‚
         â–¼                                â–¼                                â–¼
   [admin]                         [supervisor]                      [operator]
   ID: 1                           ID: 2                             ID: 3
   Role: 0                         Role: 1                           Role: 2
         â”‚                                â”‚                                â”‚
         â”‚ JWT Token                      â”‚ JWT Token                      â”‚ JWT Token
         â–¼                                â–¼                                â–¼
  [AuthToken 1]                   [AuthToken 2]                   [AuthToken 3]
  Exp: +60 min                     Exp: +60 min                     Exp: +60 min
         â”‚                                â”‚                                â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚   [viewer]       â”‚
                                 â”‚   ID: 4          â”‚
                                 â”‚   Role: 3        â”‚
                                 â”‚ JWT Token 4      â”‚
                                 â”‚ Exp: +60 min     â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  DatabaseTest.Display()    â”‚
                          â”‚  â†’ Afficher tous les users â”‚
                          â”‚  â†’ Afficher tous les tokensâ”‚
                          â”‚  â†’ Afficher statistiques   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â–¼
                                    [Rapport affichÃ©]
                                           â”‚
                                           â–¼
                                   [Interface WPF]
                                       READY
```

## 4. Structure des fichiers

```
C:\Users\HP\Desktop\NetAdminPro\
â”‚
â”œâ”€â”€ netadmin.db (ğŸ”´ SQLite - CrÃ©Ã© Ã  l'exÃ©cution)
â”‚
â”œâ”€â”€ NetAdmin.Server\
â”‚   â”‚
â”‚   â”œâ”€â”€ Program.cs (ğŸŸ¢ Initialisation + Services)
â”‚   â”‚
â”‚   â”œâ”€â”€ Data\
â”‚   â”‚   â”œâ”€â”€ AppDbContext.cs (ğŸŸ¡ Contexte EF)
â”‚   â”‚   â””â”€â”€ Entities\
â”‚   â”‚       â”œâ”€â”€ User.cs (ğŸŸ¢ RÃ©parÃ© - propriÃ©tÃ©s initialisÃ©es)
â”‚   â”‚       â”œâ”€â”€ AuthToken.cs (ğŸŸ¢ RÃ©parÃ© - propriÃ©tÃ©s initialisÃ©es)
â”‚   â”‚       â”œâ”€â”€ AuditLog.cs (ğŸŸ¢ RÃ©parÃ© - propriÃ©tÃ©s initialisÃ©es)
â”‚   â”‚       â”œâ”€â”€ ClientHost.cs (ğŸŸ¢ RÃ©parÃ© - propriÃ©tÃ©s initialisÃ©es)
â”‚   â”‚       â””â”€â”€ MetricLog.cs (ğŸŸ¢ RÃ©parÃ© - propriÃ©tÃ©s initialisÃ©es)
â”‚   â”‚
â”‚   â””â”€â”€ Services\
â”‚       â”œâ”€â”€ AuthenticationService.cs (ğŸŸ¡ Authentification + BCrypt)
â”‚       â”œâ”€â”€ DatabaseInitializer.cs (ğŸŸ¡ CrÃ©ation utilisateurs)
â”‚       â”œâ”€â”€ DatabaseTest.cs (ğŸŸ¢ Nouveau - Rapport de statut)
â”‚       â”œâ”€â”€ SessionManager.cs (ğŸŸ¢ RÃ©parÃ© - propriÃ©tÃ©s initialisÃ©es)
â”‚       â””â”€â”€ TcpServer.cs (ğŸŸ¢ RÃ©parÃ© - champ initialisÃ©)
â”‚
â”œâ”€â”€ netadmin.db (ğŸ”´ SQLite dans NetAdmin.Server\)
â”‚
â””â”€â”€ netadmin.db (ğŸ”´ SQLite dans bin\Debug\net10.0-windows\)

Documentation crÃ©Ã©e:
â”œâ”€â”€ DATABASE_CONFIGURATION.md (ğŸ“— Guide complet)
â”œâ”€â”€ DATABASE_CONFIGURATION_SUMMARY.md (ğŸ“— RÃ©sumÃ©)
â”œâ”€â”€ DATABASE_TEST_GUIDE.md (ğŸ“— Guide de test)
â””â”€â”€ ARCHITECTURE_DATABASE.md (ğŸ“— Ce fichier)

LÃ©gende:
ğŸ”´ = Fichier SQLite (donnÃ©es)
ğŸŸ¢ = Fichier crÃ©Ã©/corrigÃ©
ğŸŸ¡ = Fichier existant (non modifiÃ©)
```

## 5. Cycle de vie d'une authentification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Cycle d'authentification                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CLIENT (AuthenticationClient)
   â”‚
   â”‚ 1. Envoyer LoginRequest
   â”‚    {username: "admin", password: "Admin@123!"}
   â”‚
   â–¼
SERVER (AuthenticationService.Authenticate)
   â”‚
   â”œâ”€ 2. Chercher user dans BD
   â”‚     User user = context.Users.FirstOrDefault(u => u.Username == "admin")
   â”‚
   â”œâ”€ 3. VÃ©rifier le mot de passe (BCrypt)
   â”‚     BCrypt.Verify(password, user.PasswordHash)
   â”‚
   â”œâ”€ 4. GÃ©nÃ©rer JWT Token
   â”‚     CreateSecurityToken(user, clientIp)
   â”‚     {header: HS256, payload: {sub, username, role, exp...}, signature}
   â”‚
   â”œâ”€ 5. GÃ©nÃ©rer Refresh Token
   â”‚     Guid.NewGuid().ToString()
   â”‚
   â”œâ”€ 6. Sauvegarder AuthToken
   â”‚     new AuthToken {
   â”‚       UserId: 1,
   â”‚       Token: JWT,
   â”‚       RefreshToken: REFRESH,
   â”‚       ExpiresAt: now + 60 min,
   â”‚       IpAddress: clientIp,
   â”‚       UserAgent: userAgent
   â”‚     }
   â”‚     context.AuthTokens.Add(token)
   â”‚     context.SaveChanges()
   â”‚
   â–¼
CLIENT (ReÃ§oit LoginResponse)
   â”‚
   â”œâ”€ 7. Stocker le JWT en mÃ©moire
   â”‚
   â”œâ”€ 8. Utiliser le JWT pour les requÃªtes suivantes
   â”‚     GET /api/systeminfo
   â”‚     Authorization: Bearer eyJhbGc...
   â”‚
   â–¼
SERVER (Valide le JWT)
   â”‚
   â””â”€ 9. ValidateToken(jwtToken)
       â”œâ”€ VÃ©rifier la signature
       â”œâ”€ VÃ©rifier l'expiration
       â”œâ”€ VÃ©rifier la rÃ©vocation
       â”œâ”€ Extraire les claims
       â””â”€ Permettre ou refuser l'accÃ¨s
```

## 6. SÃ©curitÃ© - Couches de protection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Couches de sÃ©curitÃ©                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Couche 1: Stockage des mots de passe
â”œâ”€ BCrypt avec salt (coÃ»t 10)
â”œâ”€ Hashs non-rÃ©versibles
â””â”€ Impossible de retrouver le mot de passe original âœ…

Couche 2: Tokens JWT
â”œâ”€ Signature HMAC-SHA256
â”œâ”€ Secret de 32+ caractÃ¨res
â”œâ”€ Expiration 60 minutes
â””â”€ RÃ©vocation possible âœ…

Couche 3: Validation du token
â”œâ”€ VÃ©rification de la signature
â”œâ”€ VÃ©rification de l'expiration
â”œâ”€ VÃ©rification de la rÃ©vocation
â””â”€ Validation des claims âœ…

Couche 4: RÃ´les et permissions
â”œâ”€ 4 rÃ´les: Administrator, Supervisor, Operator, Viewer
â”œâ”€ Chaque requÃªte vÃ©rifiÃ©e contre le rÃ´le
â””â”€ AccÃ¨s granulaire âœ…

Couche 5: Audit logging
â”œâ”€ Chaque action enregistrÃ©e (AuditLog)
â”œâ”€ TraÃ§abilitÃ© des utilisateurs
â”œâ”€ Timestamps prÃ©cis
â””â”€ DÃ©tails des opÃ©rations âœ…

âš ï¸ Ã€ ajouter en production:
â”œâ”€ HTTPS/TLS
â”œâ”€ Rotation des JWT secrets
â”œâ”€ Limitation de dÃ©bit (rate limiting)
â”œâ”€ DÃ©tection d'anomalies
â””â”€ Sauvegarde sÃ©curisÃ©e
```

## 7. Statistiques de compilation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           RÃ©sultats de la compilation                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Avant correction:
  âŒ Erreurs: 2
  âš ï¸  Avertissements: 36
  â±ï¸  Temps: 13,8s

AprÃ¨s correction:
  âœ… Erreurs: 0
  âš ï¸  Avertissements: 4 (non-bloquants - LiveCharts)
  â±ï¸  Temps: 3,4s

AmÃ©lioration: ğŸ‰
  âœ… 2 erreurs rÃ©solues (100%)
  âœ… 32 avertissements rÃ©solus (89%)
  âœ… Temps de compilation: -75%
```

## 8. Ã‰tat de la base de donnÃ©es aprÃ¨s initialisation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Ã‰tat initial de la base de donnÃ©es              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TABLE: Users (4 lignes)
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Id â”‚ Username   â”‚ Role             â”‚ IsActive      â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1 â”‚ admin      â”‚ Administrator(0) â”‚ True          â”‚
â”‚  2 â”‚ supervisor â”‚ Supervisor(1)    â”‚ True          â”‚
â”‚  3 â”‚ operator   â”‚ Operator(2)      â”‚ True          â”‚
â”‚  4 â”‚ viewer     â”‚ Viewer(3)        â”‚ True          â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TABLE: AuthTokens (4 lignes)
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Id â”‚ UserId â”‚ IsActive         â”‚ ExpiresAt      â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1 â”‚   1    â”‚ True             â”‚ +60 min        â”‚
â”‚  2 â”‚   2    â”‚ True             â”‚ +60 min        â”‚
â”‚  3 â”‚   3    â”‚ True             â”‚ +60 min        â”‚
â”‚  4 â”‚   4    â”‚ True             â”‚ +60 min        â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TABLE: AuditLogs (0 lignes)
â”œâ”€ Aucun log initial âœ“

TABLE: ClientHosts (0 lignes)
â”œâ”€ Aucun client initial âœ“

TABLE: MetricLogs (0 lignes)
â”œâ”€ Aucune mÃ©trique initiale âœ“

Taille fichier: 126,976 bytes
CrÃ©Ã©: [Timestamp]
Format: SQLite 3
```
